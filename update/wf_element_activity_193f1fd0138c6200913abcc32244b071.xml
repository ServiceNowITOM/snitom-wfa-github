<?xml version="1.0" encoding="UTF-8"?>
<record_update table="wf_element_activity">
    <wf_element_activity action="INSERT_OR_UPDATE">
        <access>public</access>
        <attributes/>
        <base_provider display_value="Run Script">d0c7fe11eb013100fc5e8a7af106fee0</base_provider>
        <category/>
        <checked_out_by/>
        <default_height/>
        <default_width/>
        <description>Creates a Repo</description>
        <image>images/heisenberg_icons/workflow_ie8/provider_runscript.png</image>
        <input_meta>{"name":"Input","type":"DATA_OBJECT","properties":[{"name":"name","type":"STRING","mandatory":true},{"name":"description","type":"STRING","mandatory":true},{"name":"isprivate","type":"BOOLEAN","mandatory":true},{"name":"homepage","type":"STRING","mandatory":false},{"name":"issues","type":"BOOLEAN","mandatory":true},{"name":"wiki","type":"BOOLEAN","mandatory":true},{"name":"downloads","type":"BOOLEAN","mandatory":true},{"name":"Username","type":"STRING","mandatory":true},{"name":"Password","type":"STRING","mandatory":true}]}</input_meta>
        <input_process_script/>
        <input_transform/>
        <local_variables/>
        <name>Create a Repo</name>
        <output_meta>{"name":"Output","type":"DATA_OBJECT","properties":[{"name":"repo","type":"STRING"}]}</output_meta>
        <output_process_script/>
        <output_transform/>
        <processing_script><![CDATA[/*
In
activityInput.Repository_Full_Name
activityInput.name string
activityInput.description string
activityInput.private bool
activityInput.homepage string
activityInput.issues bool
activityInput.wiki bool
activityInput.downloads bool
activityInput.Username
activityInput.Password


Out
activityOutput.repo
*/


var juser;
var jpass;
//See if Username has been set
if (activityInput.Username){
	juser = activityInput.Username;
	jpass = activityInput.Password;

}

//If Username has not been set lok it up from table.
else{
	var GL = new GlideRecord('x_snc_itom_github_github_repositories');
	GL.addQuery('full_name' ,activityInput.Repository_full_name);
	GL.query();
	while (GL.next()) {
		juser = GL.credentials.user;
		var pass = GL.credentials.password;
		jpass = GL.credentials.password.getDecryptedValue();
	}
}
//Build Web Request Body
var restbody = {
  "name": activityInput.name,
  "description": activityInput.description,
  "homepage": activityInput.homepage,
  "private": activityInput.isprivate,
  "has_issues": activityInput.issues,
  "has_wiki": activityInput.wiki,
  "has_downloads": activityInput.downloads
};



//Build WebCall
var restMessage = new sn_ws.RESTMessageV2();
//var mysplit = activityInput.Repository_full_name.split('/');
//var repo = mysplit[1];
//var owner = mysplit[0];
gs.info("Username:" + juser + " *** Password: " + jpass);
restMessage.setBasicAuth(juser, jpass);
restMessage.setHttpMethod("post");
var myurl = 'https://api.github.com/user/repos';
restMessage.setEndpoint(myurl);
restMessage.setRequestBody(global.JSON.stringify(restbody));
var httpExecute = restMessage.execute();
if (httpExecute.getStatusCode() != 201){
	throw httpExecute.getErrorMessage() + httpExecute.getBody();
}
var messageBody = httpExecute.getBody();
//Set Output
activityOutput.repo = messageBody;
]]></processing_script>
        <sample_payloads>{}</sample_payloads>
        <short_description>Will Create a Repo</short_description>
        <style/>
        <sys_class_name>wf_element_activity</sys_class_name>
        <sys_created_by>shaun.millin</sys_created_by>
        <sys_created_on>2016-06-12 20:46:06</sys_created_on>
        <sys_customer_update>true</sys_customer_update>
        <sys_id>193f1fd0138c6200913abcc32244b071</sys_id>
        <sys_mod_count>8</sys_mod_count>
        <sys_name>Create a Repo</sys_name>
        <sys_package display_value="Github Management" source="x_snc_itom_github">1b332a2613efd200913abcc32244b00d</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Github Management">1b332a2613efd200913abcc32244b00d</sys_scope>
        <sys_update_name>wf_element_activity_193f1fd0138c6200913abcc32244b071</sys_update_name>
        <sys_updated_by>shaun.millin</sys_updated_by>
        <sys_updated_on>2016-06-12 21:08:15</sys_updated_on>
        <version_container_id>5e6f5fd0138c6200913abcc32244b0c6</version_container_id>
    </wf_element_activity>
    <sys_translated_text action="delete_multiple" query="documentkey=193f1fd0138c6200913abcc32244b071"/>
    <wf_versionable action="INSERT_OR_UPDATE">
        <checked_out/>
        <checked_out_by/>
        <published>true</published>
        <sys_created_by>shaun.millin</sys_created_by>
        <sys_created_on>2016-06-12 20:46:06</sys_created_on>
        <sys_id>166f5fd0138c6200913abcc32244b0c7</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_updated_by>shaun.millin</sys_updated_by>
        <sys_updated_on>2016-06-12 21:08:15</sys_updated_on>
        <valid_from>2016-06-12 21:08:15</valid_from>
        <valid_to/>
        <version>1</version>
        <version_container_id>5e6f5fd0138c6200913abcc32244b0c6</version_container_id>
        <wf_element_definition display_value="Create a Repo">193f1fd0138c6200913abcc32244b071</wf_element_definition>
    </wf_versionable>
    <wf_versionable action="update_multiple" query="version_container_id=5e6f5fd0138c6200913abcc32244b0c6^sys_id!=166f5fd0138c6200913abcc32244b0c7">
        <published>false</published>
    </wf_versionable>
    <wf_activity action="update_multiple" is_dot_walk_query="true" query="workflow_version.published=true^activity_definition.version_container_id=5e6f5fd0138c6200913abcc32244b0c6^pinned=true">
        <new_activity_definition>193f1fd0138c6200913abcc32244b071</new_activity_definition>
        <out_of_date>true</out_of_date>
        <notes>There is a newer version of this activity. To update the activity, check out the workflow, select the activity, right click and select update activity to use the latest version.</notes>
    </wf_activity>
    <wf_activity action="update_multiple" is_dot_walk_query="true" query="workflow_version.published=true^activity_definition.version_container_id=5e6f5fd0138c6200913abcc32244b0c6^pinned=false">
        <activity_definition>193f1fd0138c6200913abcc32244b071</activity_definition>
        <activity_definition_updated>true</activity_definition_updated>
        <notes>This activity was updated to a newer version since the workflow was published.</notes>
    </wf_activity>
</record_update>
